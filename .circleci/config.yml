version: 2.0
jobs:
  build:
    working_directory: ~/vault-circleci-auth-plugin
    docker:
      - image: docker:17.11.0-ce
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Build plugin
          command: |
            docker build -t build -f Dockerfile.build .
            docker create --rm --name build build
            docker cp build:/go/src/github.com/marcboudreau/vault-circleci-auth-plugin/vault-circleci-auth-plugin ./vault-circleci-auth-plugin
            docker rm build
      - run:
          name: Integration Test
          working_directory: ~/vault-circleci-auth-plugin/integration-test
          command: |
            apk add --update-cache bash
            ./tests.sh
      